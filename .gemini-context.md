# System Context for Gemini

This file provides a quick refresher on the hardware, software, and goals of this homelab environment.

## 1. Hardware

- **Nodes:** 3x GEEKOM Mini IT13 Mini PCs.
- **CPU:** Intel 13th Gen.
- **Disk Layout (per node):**
  - **System Drive (OS & etcd):** 1x SATA SSD (Intel DC S3500 - `SSDSC2BB48`). This drive must remain SATA.
  - **Ceph Storage:** 1x M.2 NVMe SSD used for a `rook-ceph` cluster.
  - **OpenEBS Storage:** 1x M.2 SSD (in the former Wi-Fi slot) used for `openebs`.

## 2. Software & Orchestration

- **Operating System:** Talos Linux.
- **Orchestrator:** Kubernetes.
  - **Version:** Talos-flavored Kubernetes v1.35.0 (corresponding to Talos OS v1.12.3).
- **CNI:** Cilium.
- **Storage Services:** `rook-ceph` and `openebs`.
- **Backup Solution:** `volsync` is used for backing up PVCs.

## 3. Configuration & Philosophy

- **Configuration:**
  - The repository follows a GitOps workflow.
  - Talos machine configurations are managed via Jinja2 templates (`.j2`).
  - Secrets are managed in 1Password and referenced in manifests using `op://` syntax.
- **Jinja2 Version:** The Home Assistant instance uses Jinja2 v3.1.6, which notably **does not** support the `where` filter.
- **General Goals:**
  - **Performance:** Performance is often prioritized over maximum security (e.g., using `mitigations=off` kernel argument).
  - **Rootless Containers:** Preference for converting applications to run in rootless containers.
- **Monitoring:**
  - The cluster is monitored by Prometheus & Grafana.
  - Alerts (like `KubeAPIErrorBudgetBurn`) originate from the standard `kube-prometheus` stack.

## 4. Network

- **Core Router:** Unifi Dream Machine Special Edition (UDM-SE)
- **Core Switch:** Unifi USW Pro Max 24
- **Connectivity:**
  - UDM-SE (SFP Port 11) -> USW Pro Max 24 (SFP Port 25) @ 10GbE
  - USW Pro Max 24 (SFP Port 26) -> QNAP TS-462 NAS @ 10GbE
- **Switches:**
  - `USW Ultra 8 Port`: Connected to USW Pro Max 24 (Port 24).
  - `USW Flex`: Connected to USW Ultra, for outdoor use.
- **Wi-Fi Access Points:**
  - 1x U6-LR (connected to USW Pro Max 24, Port 23)
  - 1x U7 Pro (connected to USW Ultra)
  - 1x U6-LR (in barn, connected to USW Ultra)
  - 1x U7 Outdoor (connected to USW Flex)

- **VLANs & Subnets:**
  - `VLAN 1` (Default): Control plane for Unifi devices. Subnet: `192.168.86.0/24`
  - `VLAN 10` (Family): For phones, tablets, laptops, printers. Subnet: `192.168.10.0/24`
  - `VLAN 29` (Cilium LB IP Pool): For load balanced pods in the Kubernetes cluster. Subnet: `192.168.29.0/24` (Corrected from `192.168.829.0`)
  - `VLAN 30` (Homelab): For the Kubernetes nodes. Subnet: `192.168.30.0/24`
  - `VLAN 50` (IoT): For smart home devices. Subnet: `192.168.50.0/24` (Accessible through Multus for Kubernetes nodes to multi-home IP addresses).
  - `VLAN 90` (VPN): Dedicated VPN network, connected to a persistent Wireguard server. Subnet: `192.168.90.0/24`
  - `VLAN 101` (Guest): For guest phones, tablets and laptops. Subnet: `192.168.101.0/24`

- **Kubernetes Nodes:**
  - `k8s-0` (`192.168.30.10`): Connected to USW Pro Max 24, Port 19 @ 2.5GbE
  - `k8s-1` (`192.168.30.11`): Connected to USW Pro Max 24, Port 20 @ 2.5GbE
  - `k8s-2` (`192.168.30.12`): Connected to USW Pro Max 24, Port 21 @ 2.5GbE

- **Internet Connection:**
  - Provider: XFinity
  - Speed: 1100 Mb download
  - Modem/Gateway: Unifi UCI

## 5. Power Infrastructure

- **Primary UPS:** Redundant Power Supply (UPS RPS)
- **Rack-mount UPS:** UPS 2U BackUPS unit.
- **Power Distribution:** UPS PDU (Power Distribution Block).
- **Dedicated UPS for Talos Nodes:** Unifi UPS Tower BackUPS.

