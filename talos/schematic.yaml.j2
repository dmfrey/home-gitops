---
customization:
  extraKernelArgs:
    - -init_on_alloc                      # Less security, faster puter
    - -init_on_free                       # Less security, faster puter
    - -selinux                            # Less security, faster puter

    # --- Performance & Security Tradeoffs ---
    - mitigations=off                     # Disables CPU speculative execution mitigations
    - apparmor=0                          # Disable AppArmor LSM
    - security=none                       # Disable default security profile
    - init_on_alloc=0                     # Disable zeroing memory on allocation
    - init_on_free=0                      # Disable zeroing memory on free
    - talos.auditd.disabled=1             # Disable Linux audit daemon

    # --- Hardware Enablement & Virtualization ---
    - intel_iommu=on                      # Enable the IOMMU
    - iommu=pt                            # Use passthrough mode for IOMMU
    - i915.enable_guc=3                   # Enable GuC/HuC for 13th-gen Intel iGPU
    - sysctl.kernel.kexec_load_disabled=1 # Security hardening

    # --- System Configuration ---
    - net.ifnames=0

    # --- Recommended Performance Tuning Arguments (for future reference) ---
    #
    # # Sets the I/O scheduler to prioritize latency, which is critical for etcd.
    # # This is the most direct tuning for the disk I/O issues.
    # - elevator=mq-deadline
    #
    # # Tells the kernel the Time Stamp Counter is reliable, reducing timing-related overhead.
    # - tsc=reliable
    #
    # # Isolates specific CPU cores from OS timer ticks, reducing jitter for sensitive workloads.
    # # The core list should be chosen based on your CPU topology (e.g., a few E-cores).
    # - nohz_full=4,5,6,7
  systemExtensions:
    officialExtensions:
      - siderolabs/gasket-driver          # M.2 Google Coral accelerators
      - siderolabs/i915                   # Intel iGPU
      - siderolabs/intel-ice-firmware      # Intel Ethernet firmware
      - siderolabs/intel-ucode            # Intel iGPU
      - siderolabs/mei                    # Intel Management Engine drivers
      - siderolabs/nut-client             # Network UPS Tools
      - siderolabs/nvme-cli               # NVMe command line tools
      - siderolabs/util-linux-tools       # Useful Linux tools
