state_dir /cache/state
runtime_dir /cache/run

openmetrics tcp://0.0.0.0:{env:SMTP_RELAY_METRICS_PORT} { }

tls off
hostname {env:SMTP_DOMAIN}

smtp tcp://0.0.0.0:{env:SMTP_RELAY_SMTP_PORT} {
    debug {env:DEBUG}
    io_debug {env:DEBUG}

    source {env:SMTP_DOMAIN} {
        deliver_to &remote_queue
    }

    default_source {
        reject
    }

}

target.queue remote_queue {
    debug {env:DEBUG}
    target &remote_smtp
    # target &mailersend
}

target.smtp remote_smtp {
    debug {env:DEBUG}

    auth plain {env:SMTP_RELAY_USERNAME} {env:SMTP_RELAY_PASSWORD}
    targets tcp://{env:SMTP_RELAY_SERVER}:{env:SMTP_RELAY_SERVER_PORT}
}

# target.smtp mailersend {
#   host {env:SMTP_RELAY_SERVER}:{env:SMTP_RELAY_SERVER_PORT}

#   starttls

#   auth plain {
#     username {env:SMTP_RELAY_USERNAME}
#     password {env:SMTP_RELAY_PASSWORD}
#   }

#   timeout 30s
# }
